# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj

version: 2

before:
  hooks:
    - go mod tidy
    - go generate ./...

builds:
  - id: apmsoak
    main: ./cmd/apmsoak
    binary: apmsoak-{{.Os}}-{{.Arch}}
    env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -X github.com/elastic/apm-perf/internal/version.commitSha={{.FullCommit}}
      - -X github.com/elastic/apm-perf/internal/version.buildTime={{.Date}}
    no_unique_dist_dir: true
  - id: apmbench
    main: ./cmd/apmbench
    binary: apmbench-{{.Os}}-{{.Arch}}
    env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -X github.com/elastic/apm-perf/internal/version.commitSha={{.FullCommit}}
      - -X github.com/elastic/apm-perf/internal/version.buildTime={{.Date}}
    no_unique_dist_dir: true
  - id: apmtelemetrygen
    main: ./cmd/apmtelemetrygen
    binary: apmtelemetrygen-{{.Os}}-{{.Arch}}
    env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags:
      - -X github.com/elastic/apm-perf/internal/version.commitSha={{.FullCommit}}
      - -X github.com/elastic/apm-perf/internal/version.buildTime={{.Date}}
    no_unique_dist_dir: true
